<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Places from Foursquare</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
<div id='map'></div>

<!-- jQuery is required for this example. -->
<script src='https://code.jquery.com/jquery-1.8.0.min.js'></script>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoianVuaXBlcnRjeSIsImEiOiJvOFg5WFVjIn0.7NDB1oOLpq3A5qO7vLaQSA';
var map = L.mapbox.map('map', 'mapbox.emerald')
    .setView([40.6941, -73.8758], 10);

// Credit Foursquare for their wonderful data
map.attributionControl
    .addAttribution('<a href="https://foursquare.com/">Places data from Foursquare</a>');

// Create a Foursquare developer account: https://developer.foursquare.com/
// NOTE: CHANGE THESE VALUES TO YOUR OWN:
// Otherwise they can be cycled or deactivated with zero notice.
var CLIENT_ID = 'XLHPIKCTAX3U1MMYWRAREX1IL04AERN43FOP5DSJUXUJCZ4L';
var CLIENT_SECRET = 'OVSF1TYXOMDOIUAIVO1WZB4JILUJODLYUKG5BGWIZXBNVCCN';

// https://developer.foursquare.com/start/search
var API_ENDPOINT = 'http://localhost:3000&lat=LAT&lng=LNG';

// Keep our place markers organized in a nice group.
var foursquarePlaces = L.layerGroup().addTo(map);

// Use jQuery to make an AJAX request to Foursquare to load markers data.
$.getJSON(API_ENDPOINT
    .replace('CLIENT_ID', CLIENT_ID)
    .replace('CLIENT_SECRET', CLIENT_SECRET)
    .replace('LAT', map.getCenter().lat)
    .replace('LNG', map.getCenter().lng), function(result, status) {

      console.log(result);

    if (status !== 'success') return alert('Request to Foursquare failed');

    // Transform each venue result into a marker on the map.
    for (var i = 0; i < result.data.length; i++) {
      var venue = result.data[i];
      var latlng = L.latLng(venue.location.lat, venue.location.lng);
      var marker = L.marker(latlng, {
          icon: L.mapbox.marker.icon({
            'marker-color': '#BE9A6B',
            'marker-symbol': 'cafe',
            'marker-size': 'large'
          })
        })
      .bindPopup('<strong><a href="https://foursquare.com/v/' + venue.categories.id + '">' +
        venue.location.name + '</a></strong>')
        .addTo(foursquarePlaces);
    }

});
</script>
</body>
</html>